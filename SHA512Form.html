<script src="scripts/material.min.js"></script>

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-deep_purple.min.css"/>

<script src="scripts/jquery-latest.min.js" type="text/javascript"></script>


<div class="mdl-card demo-charts mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col">
    <div class="CryptTitle">SHA512
        <div id="sha512Icon" class="icon material-icons">info_outline</div>
        <div class="mdl-tooltip mdl-tooltip--large" for="sha512Icon">
            SHA-256 и SHA-512, и, в меньшей степени, SHA-224 и SHA-384 подвержены атакам расширения длины, делая его
            небезопасным для некоторых приложений. Поэтому обычно рекомендуется переключиться на SHA-3 для 512-битных
            хэшей и использовать SHA-512/224 и SHA-512/256 вместо SHA-224 и SHA-256. Это также происходит быстрее, чем
            SHA-224 и SHA-256 на x86-64, так как SHA-512 работает на 64 бит вместо 32 битных слов.
        </div>
    </div>

    <form action="#">

        <div class="mdl-textfield--floating-label mdl-js-textfield mdl-textfield">
            <label class="mdc-text-field mdc-text-field--outlined">
                <input type="text" class="mdc-text-field__input" aria-labelledby="my-label-id">
                <span class="mdc-notched-outline">
    <span class="mdc-notched-outline__leading"></span>
    <span class="mdc-notched-outline__notch">
      <span class="mdc-floating-label" id="my-label-id">Your Name</span>
    </span>
    <span class="mdc-notched-outline__trailing"></span>
  </span>
            </label>
        </div>

        <div class="or_horizontal">
            <button onclick="Click(0,'InputText','CryptText','LabelText','CryptLabel')"
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                Кодировать
            </button>

            <button onclick="Click(1,'InputText','CryptText','LabelText','CryptLabel')"
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                Декодировать
            </button>
        </div>

        <div class="mdl-textfield--floating-label mdl-js-textfield mdl-textfield">
            <textarea class="mdl-textfield__input" type="text" rows="5" id="CryptText"></textarea>
            <label id="CryptLabel" class="mdl-textfield__label" for="CryptText">Результат</label>
        </div>

        <div class="or_horizontal">
            <button onclick="copyToClipboard('CryptText')"
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                Копировать
            </button>

            <button onclick="ClearFields('InputText','CryptText','LabelText','CryptLabel')"
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                Очистить
            </button>
        </div>
    </form>
</div>

<script type="text/javascript">
    function utf8_to_b64(str) {
        return window.btoa(unescape(encodeURIComponent(str)));
    }

    function b64_to_utf8(str) {
        try {
            return decodeURIComponent(escape(window.atob(str)));
        } catch (e) {
        }
    }

    function Click(Choice) {
        // 0 - кодировать, 1 - декодировать
        const inputText = document.getElementById("InputText").value;
        if (inputText.length > 0) {
            NewClick();
            switch (Choice) {
                case 0: {
                    document.getElementById("CryptText").value = utf8_to_b64(inputText);
                    break
                }
                case 1: {
                    document.getElementById("CryptText").value = b64_to_utf8(inputText);
                    break
                }
            }
            document.getElementById("CryptText").focus();
            document.getElementById("CryptText").parentNode.classList.add('is-dirty');
            setCharCounter();
        }
    }

    function setCharCounter() {
        const inputField = document.getElementById("InputText").value.length;
        const outputField = document.getElementById("CryptText").value.length;

        const inputLabel = document.getElementById("LabelText");
        const outputLabel = document.getElementById("CryptLabel");

        if (inputField !== 0 && outputField !== 0) {
            inputLabel.innerHTML = "Текст" + " (" + inputField + ")";
            outputLabel.innerHTML = "Результат" + " (" + outputField + ")";
        } else {
            inputLabel.innerHTML = "Текст";
            outputLabel.innerHTML = "Результат";
        }
    }

    function NewClick() {
        document.getElementById("CryptText").value = "";
    }

    function ClearFields() {
        document.getElementById("CryptText").value = '';
        document.getElementById("InputText").value = '';
        document.getElementById("InputText").blur();
        document.getElementById("CryptText").blur();


        document.getElementById("CryptText").parentNode.classList.remove('is-dirty');
        document.getElementById("InputText").parentNode.classList.remove('is-dirty');

        setCharCounter();
    }

    function copyToClipboard() {
        if (document.getElementById("CryptText").value.length > 0) {
            document.getElementById("CryptText").select();
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
        }
    }
</script>
